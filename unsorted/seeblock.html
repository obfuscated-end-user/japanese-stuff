<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>CJK Unicode Block Viewer</title>
	<style>
		/*
		local font definitions, prevents Firefox font blocking warnings (TBD)

		go to console and change the font one by one to see what font causes a
		warning and add here if you haven't
		*/
		@font-face{font-family:"Roboto";src:local("Roboto")}
		@font-face{font-family:"Yu Mincho";src:local("Yu Mincho");}
		@font-face{font-family:"Noto Serif JP";src:local("Noto Serif JP");}
		@font-face{font-family:"Noto Sans JP";src:local("Noto Sans JP");}
		@font-face{font-family:"Georgia";src:local("Georgia");}
		@font-face{font-family:"Arial Unicode MS";src:local("Arial Unicode MS");}
		@font-face{font-family:"Tahoma";src:local("Tahoma");}
		@font-face{font-family:"Verdana";src:local("Verdana");}
		@font-face{font-family:"HanaMinA";src:local("HanaMinA");}
		@font-face{font-family:"HanaMinB";src:local("HanaMinB");}
		@font-face{font-family:"Meiryo";src:local("Meiryo");}
		@font-face{font-family:"IPAexGothic";src:local("IPAexGothic");}
		@font-face{font-family:"IPAexMincho";src:local("IPAexMincho");}
		@font-face{font-family:"TakaoPMincho";src:local("TakaoPMincho");}
		@font-face{font-family:"TakaoExMincho";src:local("TakaoExMincho");}
		@font-face{font-family:"BIZ UDGothic";src:local("BIZ UDGothic");}
		@font-face{font-family:"BIZ UDMincho Medium";src:local("BIZ UDMincho Medium");}
		@font-face{font-family:"UD Digi Kyokasho N-R";src:local("UD Digi Kyokasho N-R");}
		@font-face{font-family:"YOzFontK";src:local("YOzFontK");}
		@font-face{font-family:"851MkPOP";src:local("851MkPOP");}
		@font-face{font-family:"apricotJapanesefont";src:local("apricotJapanesefont");}
		@font-face{font-family:"apricotJapanesefontT";src:local("apricotJapanesefontT");}
		@font-face{font-family:"DotGothic16";src:local("DotGothic16");}
		@font-face{font-family:"FUTENE";src:local("FUTENE");}
		@font-face{font-family:"irohamaru mikami Regular";src:local("irohamaru mikami Regular");}
		@font-face{font-family:"Kiwi Maru";src:local("Kiwi Maru");}
		@font-face{font-family:"Kosugi Maru";src:local("Kosugi Maru");}
		@font-face{font-family:"S2G Mooon font-PRO";src:local("S2G Mooon font-PRO");}
		@font-face{font-family:"Mplus 1";src:local("Mplus 1");}
		@font-face{font-family:"M + 2p";src:local("M + 2p");}
		@font-face{font-family:"Mplus 2";src:local("Mplus 2");}
		@font-face{font-family:"S2G Sea font-PRO";src:local("S2G Sea font-PRO");}
		@font-face{font-family:"SoukouMincho";src:local("SoukouMincho");}
		@font-face{font-family:"umeboshi";src:local("umeboshi");}
		@font-face{font-family:"Unifont-JP";src:local("Unifont-JP");}
		@font-face{font-family:"Zen Antique";src:local("Zen Antique");}
		@font-face{font-family:"Zen Antique Soft";src:local("Zen Antique Soft");}
		@font-face{font-family:"Zen Kaku Gothic Antique";src:local("Zen Kaku Gothic Antique");}
		@font-face{font-family:"DartsFont";src:local("DartsFont");}
		@font-face{font-family:"HosofuwaFont";src:local("HosofuwaFont");}
		@font-face{font-family:"ShigotoMemogaki";src:local("ShigotoMemogaki");}
		@font-face{font-family:"Yuzu PenJiN [M]";src:local("Yuzu PenJiN [M]");}
		@font-face{font-family:"Yuzu PenJiN [P]";src:local("Yuzu PenJiN [P]");}
		@font-face{font-family:"Plangothic P2";src:local("Plangothic P2");}

		body {
			font-family: "Segoe UI",system-ui, -apple-system, Roboto, sans-serif;
			margin: 0 10% auto;
			padding: 20px;
			background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
			min-height: 100vh;
		}
		h1 {
			color: #2c3e50;
			text-align: center;
			font-size: 2.2em;
			margin-bottom: 10px;
			text-shadow: 0 2px 4px rgba(0,0,0,0.1);
		}
		h2 {
			color: #34495e;
			border-bottom: 2px solid #3498db;
			padding-bottom: 8px;
			margin-bottom: 15px;
		}
		.legend {
			display: grid;
			grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
			gap: 12px;
			margin-bottom: 25px;
			background: white;
			padding: 20px;
			border-radius: 12px;
			box-shadow: 0 4px 12px rgba(0,0,0,0.1);
		}
		.legend-item {
			display: flex;
			align-items: center;
			gap: 10px;
			padding: 10px;
			border-radius: 8px;
			transition: transform 0.2s;
		}
		.legend-item:hover {
			transform: translateY(-2px);
			box-shadow: 0 4px 8px rgba(0,0,0,0.15);
		}
		.legend-color {
			width: 24px;
			height: 24px;
			border-radius: 4px;
			border: 2px solid rgba(255,255,255,0.8);
			box-shadow: 0 2px 4px rgba(0,0,0,0.2);
		}
		.count-badge {
			background: rgba(52,152,219,0.2);
			color: #2980b9;
			border-radius: 12px;
			padding: 4px 8px;
			font-size: 0.85em;
			font-weight: 600;
			min-width: 28px;
			text-align: center;
		}
		.controls {
			display: flex;
			flex-direction: column;
			gap: 15px;
			margin-bottom: 20px;
		}
		#convert-btn, #sample-text-btn, #clear-btn {
			background: linear-gradient(135deg, #3498db, #2980b9);
			color: white;
			border: none;
			padding: 12px 24px;
			font-size: 16px;
			font-weight: 600;
			border-radius: 25px;
			cursor: pointer;
			transition: all 0.3s;
			box-shadow: 0 4px 12px rgba(52,152,219,0.4);
		}
		#clear-btn {
			background: linear-gradient(135deg, #e74c3c, #c0392b);
			box-shadow: 0 4px 12px rgba(231,76,60,0.4);
		}
		#clear-btn:hover {
			background: linear-gradient(135deg, #c0392b, #a93226);
			box-shadow: 0 6px 20px rgba(231,76,60,0.6);
		}
		#convert-btn:hover, #sample-text-btn:hover {
			transform: translateY(-2px);
			box-shadow: 0 6px 20px rgba(52,152,219,0.6);
		}
		#input-text {
			width: auto;
			padding: 15px;
			font-family: monospace;
			font-size: 14px;
			border: 2px solid #ddd;
			border-radius: 10px;
			resize: none;
			transition: border-color 0.3s;
			box-shadow: 0 2px 8px rgba(0,0,0,0.1);
			height: 100px;
		}
		#input-text:focus {
			outline: none;
			border-color: #3498db;
			box-shadow: 0 0 0 3px rgba(52,152,219,0.2);
		}
		#preview { 
			font-family: "Yu Mincho", "Times New Roman", times, serif; 
			font-size: var(--preview-font-size, 25px); 
			line-height: 1.6;
			min-height: 120px;
			padding: 60px;
			background: white;
			border-radius: 12px;
			box-shadow: 0 4px 12px rgba(0,0,0,0.1);
			white-space: pre-wrap;
			word-break: normal;
			position: relative;
			z-index: 0;
		}

		.cjk-unified	{ color: #c91c14; }	/* red */
		.cjk-a			{ color: #e55f2b; }	/* orange */
		.cjk-b			{ color: #e6b922; }	/* yellow */
		.cjk-c			{ color: #8ed022; }	/* chartreuse */
		.cjk-d			{ color: #1dba50; }	/* lime */
		.cjk-e			{ color: #1db9a3; }	/* spring green */
		.cjk-f			{ color: #1678c6; }	/* cyan */
		.cjk-g			{ color: #2c4dd9; }	/* azure */
		.cjk-h			{ color: #6d2ad9; }	/* blue */
		.cjk-i			{ color: #b82ad9; }	/* violet */
		.cjk-j			{ color: #d92a8f; }	/* magenta */
		.cjk-compat		{ color: #e55f5f; }	/* rose */
		.non-cjk		{ color: #000; }

		@media (max-width: 600px) {
			.legend {
				grid-template-columns: 1fr;
			}
			body {
				padding: 10px; margin: 0 5% auto;
			}
		}
		#preview a { 
			text-decoration: none; 
			display: inline-block;
			transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
			line-height: 1.6;
			transform-origin: center;
			position: relative;
		}
		#preview a:hover { 
			font-weight: 700 !important; 
			transform: scale(2);
			z-index: 9999 !important;
			-webkit-text-stroke: 2px #000 !important;
			paint-order: stroke fill;
			position: relative;
		}
		#preview a:not(:hover) { 
			transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
			transform: scale(1);
		}
		#preview.vertical {
			writing-mode: vertical-rl !important;
			overflow-y: scroll !important;
			max-height: 100% !important;
			width: -webkit-fill-available;
			padding: 30px 60px !important;
			word-break: break-all !important;
			text-orientation: mixed !important;
			border-radius: 12px;
			background: white;
			box-shadow: 0 4px 12px rgba(0,0,0,0.1);
		}
		#preview.vertical a {
			display: inline-block !important;
		}
		a.cjk-unified:hover, a.cjk-a:hover, a.cjk-b:hover, a.cjk-c:hover,
		a.cjk-d:hover, a.cjk-e:hover, a.cjk-f:hover, a.cjk-g:hover,
		a.cjk-h:hover, a.cjk-i:hover, a.cjk-j:hover, a.cjk-compat:hover {
			font-weight: 800 !important;
		}
		#back-to-top {
			position: fixed;
			bottom: 30px;
			right: 30px;
			background: linear-gradient(135deg, #3498db, #2980b9);
			color: white;
			border: none;
			border-radius: 50%;
			width: 60px;
			height: 60px;
			font-size: 24px;
			cursor: pointer;
			box-shadow: 0 4px 12px rgba(52,152,219,0.4);
			opacity: 0;
			visibility: hidden;
			transform: translateY(20px);
			transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
			z-index: 1000;
			display: flex;
			align-items: center;
			justify-content: center;
		}
		#back-to-top.show {
			opacity: 1;
			visibility: visible;
			transform: translateY(0);
		}
		#back-to-top:hover {
			transform: translateY(-4px) scale(1.05);
			box-shadow: 0 6px 20px rgba(52,152,219,0.6);
			background: linear-gradient(135deg, #2980b9, #1f5f8b);
		}
		@media (max-width: 600px) {
			#back-to-top {
				bottom: 20px;
				right: 20px;
				width: 50px;
				height: 50px;
				font-size: 20px;
			}
		}
		#font-selector {
			padding: 8px 12px;
			border-radius: 6px;
			border: 2px solid #ddd;
			font-size: 14px;
			background: #fff;
			min-width: 180px;
		}
		#font-selector:focus {
			outline: none;
			border-color: #3498db;
			box-shadow: 0 0 0 3px rgba(52,152,219,0.2);
		}
		#font-size-input {
			padding: 8px 12px;
			border-radius: 6px;
			border: 2px solid #ddd;
			font-size: 14px;
			background: #fff;
			width: 60px;
			text-align: center;
		}
		#font-size-input:focus {
			outline: none;
			border-color: #3498db;
			box-shadow: 0 0 0 3px rgba(52,152,219,0.2);
		}
		#layout-toggle {
			background: linear-gradient(135deg, #9b59b6, #8e44ad);
			color: white;
			border: none;
			padding: 12px 24px;
			font-size: 16px;
			font-weight: 600;
			border-radius: 25px;
			cursor: pointer;
			transition: all 0.3s;
			box-shadow: 0 2px 8px rgba(155, 89, 182, 0.4);
			width: 70px;
		}
		#layout-toggle:hover {
			transform: translateY(-2px);
			box-shadow: 0 4px 12px rgba(155, 89, 182, 0.6);
		}
		#layout-toggle.vertical {
			background: linear-gradient(135deg, #27ae60, #2ecc71);
			box-shadow: 0 2px 8px rgba(46, 204, 113, 0.4);
		}
		#layout-toggle.vertical:hover {
			box-shadow: 0 4px 12px rgba(46, 204, 113, 0.6);
		}
		#font-size-input:invalid {
			border-color: #e74c3c;
		}
		#random-font-btn {
			background: linear-gradient(135deg, #f39c12, #e67e22);
			color: white;
			border: none;
			padding: 10px 16px;
			font-size: 14px;
			font-weight: 600;
			border-radius: 8px;
			cursor: pointer;
			transition: all 0.3s;
			box-shadow: 0 2px 8px rgba(243,156,18,0.4);
		}
		#random-font-btn:hover {
			transform: translateY(-2px);
			box-shadow: 0 4px 12px rgba(243,156,18,0.6);
		}
		.controls {
			display: flex;
			flex-direction: column;
			gap: 15px;
			margin-bottom: 20px;
		}
		#char-stats {
			background: white;
			border-radius: 12px;
			padding: 16px;
			margin-top: 20px;
			box-shadow: 0 4px 12px rgba(0,0,0,0.1);
			font-family: monospace;
			font-size: 14px;
			display: grid;
			grid-auto-flow: column;	/* key line */
			grid-auto-columns: max-content;	/* each column sized to content */
			grid-template-rows: repeat(50, auto);	/* controls column height */
			gap: 6px 16px;
			max-height: 300px;
			overflow-x: auto;
		}
		.char-item {
			white-space: nowrap;
		}
		.char-item b {
			font-size: 1.1em;
		}
		.char-item:nth-child(-n+10) .char-rank {
			color: #d35400;
			font-weight: bold;
		}
		#char-stats a {
			text-decoration: none;
			padding: 2px 4px;
			border-radius: 4px;
			transition: transform 0.15s, text-shadow 0.15s;
		}
		#char-stats a:hover {
			transform: scale(1.3);
			text-shadow: 0 0 6px currentColor;
		}
		.char-rank {
			display: inline-block;
			min-width: 3ch;
			margin-right: 4px;
			color: #888;
			font-weight: bold;
		}
		.link-selector {
			display: flex;
			gap: 12px;
			background: white;
			padding: 8px 12px;
			border-radius: 8px;
			border: 2px solid #ddd;
			font-size: 14px;
		}
		.link-selector label {
			display: flex;
			align-items: center;
			gap: 4px;
			cursor: pointer;
			padding: 4px 8px;
			border-radius: 6px;
			transition: background 0.2s;
			white-space: nowrap;
		}
		.link-selector input[type="radio"] {
			width: 16px;
			height: 16px;
			accent-color: #3498db;
			margin: 0;
		}
		.link-selector label:hover {
			background: rgba(52,152,219,0.1);
		}
		.link-selector input:checked + span {
			font-weight: 600;
			color: #3498db;
		}
		#style-toggle {
			background: linear-gradient(135deg, #e74c3c, #c0392b);
			color: white;
			border: none;
			padding: 12px 16px;
			font-size: 16px;
			font-weight: 600;
			border-radius: 25px;
			cursor: pointer;
			transition: all 0.3s;
			box-shadow: 0 2px 8px rgba(231,76,60,0.4);
			width: 60px;
			font-family: serif;
			text-align: center;
		}
		#style-toggle:hover {
			transform: translateY(-2px);
			box-shadow: 0 4px 12px rgba(231,76,60,0.6);
		}
	</style>
</head>
<body>
	<h1>CJK Unicode Block Viewer</h1>
	<p>Most characters are in CJK Unified Ideographs, and rarely other blocks.</p>
	<h2>Legend</h2>
	<div class="legend">
		<div class="legend-item" data-block="cjk-unified">
			<div class="legend-color" style="background: #c91c14;"></div>
			<a href="https://en.wikipedia.org/wiki/CJK_Unified_Ideographs_(Unicode_block)" target="_blank" rel="noopener noreferrer" title="CJK Unified Ideographs">CJK UI (4E00-9FFF)</a>
			<span class="count-badge" data-count="cjk-unified">0</span>
		</div>
		<div class="legend-item" data-block="cjk-a">
			<div class="legend-color" style="background: #e55f2b;"></div>
			<a href="https://en.wikipedia.org/wiki/CJK_Unified_Ideographs_Extension_A" target="_blank" rel="noopener noreferrer" title="CJK Unified Ideographs Extension A">CJK A (3400-4DBF)</a>
			<span class="count-badge" data-count="cjk-a">0</span>
		</div>
		<div class="legend-item" data-block="cjk-b">
			<div class="legend-color" style="background: #e6b922;"></div>
			<a href="https://en.wikipedia.org/wiki/CJK_Unified_Ideographs_Extension_B" target="_blank" rel="noopener noreferrer" title="CJK Unified Ideographs Extension B">CJK B (20000-2A6DF)</a>
			<span class="count-badge" data-count="cjk-b">0</span>
		</div>
		<div class="legend-item" data-block="cjk-c">
			<div class="legend-color" style="background: #8ed022;"></div>
			<a href="https://en.wikipedia.org/wiki/CJK_Unified_Ideographs_Extension_C" target="_blank" rel="noopener noreferrer" title="CJK Unified Ideographs Extension C">CJK C (2A700-2B73F)</a>
			<span class="count-badge" data-count="cjk-c">0</span>
		</div>
		<div class="legend-item" data-block="cjk-d">
			<div class="legend-color" style="background: #1dba50;"></div>
			<a href="https://en.wikipedia.org/wiki/CJK_Unified_Ideographs_Extension_D" target="_blank" rel="noopener noreferrer" title="CJK Unified Ideographs Extension D">CJK D (2B740-2B81F)</a>
			<span class="count-badge" data-count="cjk-d">0</span>
		</div>
		<div class="legend-item" data-block="cjk-e">
			<div class="legend-color" style="background: #1db9a3;"></div>
			<a href="https://en.wikipedia.org/wiki/CJK_Unified_Ideographs_Extension_E" target="_blank" rel="noopener noreferrer" title="CJK Unified Ideographs Extension E">CJK E (2B820-2CEAF)</a>
			<span class="count-badge" data-count="cjk-e">0</span>
		</div>
		<div class="legend-item" data-block="cjk-f">
			<div class="legend-color" style="background: #1678c6;"></div>
			<a href="https://en.wikipedia.org/wiki/CJK_Unified_Ideographs_Extension_F" target="_blank" rel="noopener noreferrer" title="CJK Unified Ideographs Extension F">CJK F (2CEB0-2EBEF)</a>
			<span class="count-badge" data-count="cjk-f">0</span>
		</div>
		<div class="legend-item" data-block="cjk-g">
			<div class="legend-color" style="background: #2c4dd9;"></div>
			<a href="https://en.wikipedia.org/wiki/CJK_Unified_Ideographs_Extension_G" target="_blank" rel="noopener noreferrer" title="CJK Unified Ideographs Extension G">CJK G (30000-3134F)</a>
			<span class="count-badge" data-count="cjk-g">0</span>
		</div>
		<div class="legend-item" data-block="cjk-h">
			<div class="legend-color" style="background: #6d2ad9;"></div>
			<a href="https://en.wikipedia.org/wiki/CJK_Unified_Ideographs_Extension_H" target="_blank" rel="noopener noreferrer" title="CJK Unified Ideographs Extension H">CJK H (31350-323AF)</a>
			<span class="count-badge" data-count="cjk-h">0</span>
		</div>
		<div class="legend-item" data-block="cjk-i">
			<div class="legend-color" style="background: #b82ad9;"></div>
			<a href="https://en.wikipedia.org/wiki/CJK_Unified_Ideographs_Extension_I" target="_blank" rel="noopener noreferrer" title="CJK Unified Ideographs Extension I">CJK I (2EBF0-2EE5F)</a>
			<span class="count-badge" data-count="cjk-i">0</span>
		</div>
		<div class="legend-item" data-block="cjk-j">
			<div class="legend-color" style="background: #d92a8f;"></div>
			<a href="https://en.wikipedia.org/wiki/CJK_Unified_Ideographs_Extension_J" target="_blank" rel="noopener noreferrer" title="CJK Unified Ideographs Extension J">CJK J (323B0-32E9F)</a>
			<span class="count-badge" data-count="cjk-j">0</span>
		</div>
		<div class="legend-item" data-block="cjk-compat">
			<div class="legend-color" style="background: #e55f5f;"></div>
			<a href="https://en.wikipedia.org/wiki/CJK_Compatibility_Ideographs" target="_blank" rel="noopener noreferrer" title="CJK Compatibility">CJK Comp. (F900-FAFF, 2F800-2FA1F)</a>
			<span class="count-badge" data-count="cjk-compat">0</span>
		</div>
	</div>

	<div class="controls">
		<div class="control-row">
			<select id="font-selector" aria-label="Choose preview font"></select>
			<button id="random-font-btn" title="Pick random font">„Åä„Åæ„Åã„Åõ</button>
			<input type="number" id="font-size-input" min="1" max="60" value="25" step="1" aria-label="Font size (1-60px)">
			<button type="button" id="layout-toggle" title="Toggle Horizontal/Vertical Layout">‚Üî</button>
			<button type="button" id="style-toggle" title="Cycle font style">ùíúùí∑ùí∏</button>
			<input type="button" value="Convert" id="convert-btn"/>
			<input type="button" value="Sample text" id="sample-text-btn"/>
			<input type="button" value="Clear" id="clear-btn" title="Clear input and preview"/>
			<br><br>
			<div class="link-selector">
				<label><input type="radio" name="link-type" value="wiktionary-en" checked> Wiktionary (en)</label>
				<label><input type="radio" name="link-type" value="wiktionary-ja"> Wiktionary (ja)</label>
				<label><input type="radio" name="link-type" value="ctext"> CText</label>
				<label><input type="radio" name="link-type" value="youtube"> YouTube</label>
			</div>
		</div>

		<textarea id="input-text" placeholder="enter Êº¢Â≠ó"></textarea>
	</div>

	<div id="preview">„ÅÑ„Çç„ÅØ„Å´„Åª„Å∏„Å® „Å°„Çä„Å¨„Çã„Çí<br>„Çè„Åã„Çà„Åü„Çå„Åù„ÄÄ„Å§„Å≠„Å™„Çâ„ÇÄ<br>„ÅÜ„Çê„ÅÆ„Åä„Åè„ÇÑ„Åæ „Åë„Åµ„Åì„Åà„Å¶<br>„ÅÇ„Åï„Åç„ÇÜ„ÇÅ„Åø„Åó „Çë„Å≤„ÇÇ„Åõ„Åô</div>
	<h2>Character frequency</h2>
	<div id="char-stats"></div>
	<button id="back-to-top" title="Back to top">‚Üë</button>
	<script>
		const ranges = {
			"cjk-unified": [[0x4e00, 0x9fff]],
			"cjk-a": [[0x3400, 0x4dbf]],
			"cjk-b": [[0x20000, 0x2a6df]],
			"cjk-c": [[0x2a700, 0x2b73f]],
			"cjk-d": [[0x2b740, 0x2b81f]],
			"cjk-e": [[0x2b820, 0x2ceaf]],
			"cjk-f": [[0x2ceb0, 0x2ebef]],
			"cjk-g": [[0x30000, 0x3134f]],
			"cjk-h": [[0x31350, 0x323af]],
			"cjk-i": [[0x2ebf0, 0x2ee5f]],
			"cjk-j": [[0x323b0, 0x3347f]],
			"cjk-compat": [[0xf900, 0xfaff], [0x2f800, 0x2fa1f]]
		};
		document.getElementById("convert-btn").addEventListener("click", function() {
			// reenable button after click
			this.disabled = false;
			this.style.opacity = "1";
			this.style.cursor = "pointer";

			const input = document.getElementById("input-text").value;
			const preview = document.getElementById("preview");
			const charFreq = new Map();
			let html = "";

			// this is for counting how many chars are in each block
			const counters = {};
			[
				"cjk-unified", "cjk-a", "cjk-b", "cjk-c", "cjk-d", "cjk-e",
				"cjk-f", "cjk-g", "cjk-h", "cjk-i", "cjk-j", "cjk-compat"
			].forEach(block => {
				counters[block] = 0;
			});

			// add a check to see if a character within a block is an unassigned
			// codepoint
			for (let char of input) {
				const codePoint = char.codePointAt(0);
				let className = "non-cjk";
				let isCJK = false;
				// check each block using ranges object
				for (const [blockName, blockRanges] of Object.entries(ranges)) {
					for (const [start, end] of blockRanges) {
						if (codePoint >= start && codePoint <= end) {
							className = blockName;
							isCJK = true;
							break;
						}
					}
					if (isCJK)
						break;
				}

				if (isCJK) {
					counters[className]++;
					charFreq.set(char, (charFreq.get(char) || 0) + 1);
					// change link based on radio button
					const linkType = document.querySelector('input[name="link-type"]:checked').value;
					let href;
					switch(linkType) {
						case "wiktionary-ja":
							href = `https://ja.wiktionary.org/wiki/${encodeURIComponent(char)}`;
							break;
						case "ctext":
							href = `https://ctext.org/dictionary.pl?if=en&char=${encodeURIComponent(char)}`;
							break;
						case "youtube":
							href = `https://www.youtube.com/results?search_query=${encodeURIComponent(char)}`;
							break;
						case "wiktionary-en":	// DO NOT MOVE UPWARDS
						default:
							href = `https://en.wiktionary.org/wiki/${encodeURIComponent(char)}`;
					}

					html += `<a class="${className}" title="U+${codePoint.toString(16).toUpperCase().padStart(4, "0")}, ${className.toUpperCase()}" href="${href}" target="_blank" rel="noopener noreferrer">${char}</a>`;
				} else
					html += `<span class="non-cjk" title="U+${codePoint.toString(16).toUpperCase().padStart(4, "0")}">${char}</span>`;
			}

			Object.keys(counters).forEach(block => {
				const badge = document.querySelector(`[data-count="${block}"]`);
				if (badge) {
					badge.textContent = `${counters[block]}`;
					if (counters[block] > 0) {
						badge.style.background = "rgba(46,204,113,0.3)";
						badge.style.color = "#27ae60";
					} else {
						badge.style.background = "rgba(52,152,219,0.2)";
						badge.style.color = "#2980b9";
					}
				}
			});

			const totalCJK = Object.values(counters).reduce(
				(sum, v) => sum + v, 0);
			const statsDiv = document.getElementById("char-stats");

			if (charFreq.size === 0)
				statsDiv.textContent = "No CJK characters.";
			else {
				// sort by frequency (desc), then codepoint (asc)
				const sorted = [...charFreq.entries()].sort((a, b) => {
					if (b[1] !== a[1])
						return b[1] - a[1];
					return a[0].codePointAt(0) - b[0].codePointAt(0);
				});

				statsDiv.innerHTML = sorted.map(([char, count], index) => {
					const rank = index + 1;
					const codePoint = char.codePointAt(0);
					const cp = codePoint.toString(16).toUpperCase();
					const percent = totalCJK > 0 ?
						(count / totalCJK * 100).toFixed(2) : "0.00";

					// find block
					let className = "non-cjk";
					for (const [bName, bRanges] of Object.entries(ranges)) {
						for (const [start, end] of bRanges) {
							if (codePoint >= start && codePoint <= end) {
								className = bName;
								break;
							}
						}
						if (className !== "non-cjk")
							break;
					}

					return `
						<span class="char-item">
							<span class="char-rank">#${rank}</span>
							<a class="${className}"
							href="https://en.wiktionary.org/wiki/${encodeURIComponent(char)}"
							target="_blank"
							rel="noopener noreferrer"
							title="U+${cp}, ${className.toUpperCase()}">
								<b>${char}</b>
							</a> (${count}, ${percent}%)
						</span>
					`;
				}).join("");
			}

			preview.innerHTML = html || "No characters to display.";
		});

		const backToTopBtn = document.getElementById("back-to-top");
		window.addEventListener("scroll", () => {
			if (window.pageYOffset > 300)
				backToTopBtn.classList.add("show");
			else
				backToTopBtn.classList.remove("show");
		});

		backToTopBtn.addEventListener("click", () => {
			window.scrollTo({
				top: 0,
				behavior: "smooth"
			});
		});

		let fonts = [
			// web-safe fonts
			// fix the warnings in firefox such as:
			// "Request for font "Roboto" blocked at visibility level 2 (requires 3)"
			{ label: 'Yu Mincho (default)', value: '"Yu Mincho", "Times New Roman", "Plangothic P2", serif' },
			{ label: 'Noto Serif JP', value: '"Noto Serif JP", Georgia, "Plangothic P2", serif' },
			{ label: 'Noto Sans JP', value: '"Noto Sans JP", Arial, "Plangothic P2", sans-serif' },
			{ label: 'Georgia', value: 'Georgia, "Times New Roman", "Plangothic P2", serif' },
			{ label: 'Arial', value: 'Arial, Helvetica, "Plangothic P2", sans-serif' },
			{ label: 'Tahoma', value: 'Tahoma, Geneva, "Plangothic P2", sans-serif' },
			{ label: 'Verdana', value: 'Verdana, Geneva, "Plangothic P2", sans-serif' },

			// other fonts (may not be installed in your end)
			{ label: 'HanaMinA', value: '"HanaMinA", "Plangothic P2", serif' },
			{ label: 'HanaMinB', value: '"HanaMinB", "Plangothic P2", serif' },
			{ label: 'Meiryo', value: '"Meiryo", "Plangothic P2", sans-serif' },
			{ label: 'IPAexGothic', value: '"IPAexGothic", "Plangothic P2", sans-serif' },
			{ label: 'IPAexMincho', value: '"IPAexMincho", "Plangothic P2", serif' },
			{ label: 'TakaoPMincho', value: '"TakaoPMincho", "Plangothic P2", serif' },
			{ label: 'TakaoExMincho', value: '"TakaoExMincho", "Plangothic P2", serif' },
			{ label: 'BIZ UDGothic', value: '"BIZ UDGothic", "Plangothic P2", sans-serif' },
			{ label: 'BIZ UDMincho Medium', value: '"BIZ UDMincho Medium", "Plangothic P2", serif' },
			{ label: 'UD Digi Kyokasho N-R', value: '"UD Digi Kyokasho N-R", "Plangothic P2", serif' },
			{ label: 'YOzFontK', value: '"YOzFontK", "Plangothic P2", sans-serif' },
			{ label: '851MkPOP', value: '"851MkPOP", "Plangothic P2", sans-serif' },
			{ label: 'apricotJapanesefont', value: '"apricotJapanesefont", "Plangothic P2", sans-serif' },
			{ label: 'apricotJapanesefontT', value: '"apricotJapanesefontT", "Plangothic P2", sans-serif' },
			{ label: 'DotGothic16', value: '"DotGothic16", "Plangothic P2", monospace' },
			{ label: 'FUTENE', value: '"FUTENE", "Plangothic P2", sans-serif' },
			{ label: 'irohamaru mikami Regular', value: '"irohamaru mikami Regular", "Plangothic P2", cursive' },
			{ label: 'Kiwi Maru', value: '"Kiwi Maru", "Plangothic P2", serif' },
			{ label: 'Kosugi Maru', value: '"Kosugi Maru", "Plangothic P2", sans-serif' },
			{ label: 'S2G Moon font-PRO', value: '"S2G Mooon font-PRO", "Plangothic P2", serif' },
			{ label: 'Mplus 1', value: '"Mplus 1", "Plangothic P2", sans-serif' },
			{ label: 'M + 2p', value: '"M + 2p", "Plangothic P2", sans-serif' },
			{ label: 'Mplus 2', value: '"Mplus 2", "Plangothic P2", sans-serif' },
			{ label: 'S2G Sea font-PRO', value: '"S2G Sea font-PRO", "Plangothic P2", sans-serif' },
			{ label: 'SoukouMincho', value: '"SoukouMincho", "Plangothic P2", serif' },
			{ label: 'umeboshi', value: '"umeboshi", "Plangothic P2", cursive' },
			{ label: 'Unifont-JP', value: '"Unifont-JP", "Plangothic P2", monospace' },
			{ label: 'Zen Antique', value: '"Zen Antique", "Plangothic P2", serif' },
			{ label: 'Zen Antique Soft', value: '"Zen Antique Soft", "Plangothic P2", serif' },
			{ label: 'Zen Kaku Gothic Antique', value: '"Zen Kaku Gothic Antique", "Plangothic P2", sans-serif' },
			{ label: 'DartsFont', value: '"DartsFont", "Plangothic P2", sans-serif' },
			{ label: 'HosofuwaFont', value: '"HosofuwaFont", "Plangothic P2", sans-serif' },
			{ label: 'ShigotoMemogaki', value: '"ShigotoMemogaki", "Plangothic P2", sans-serif' },
			{ label: 'Yuzu PenJiN [M]', value: '"Yuzu PenJiN [M]", "Plangothic P2", sans-serif' },
			{ label: 'Yuzu PenJiN [P]', value: '"Yuzu PenJiN [P]", "Plangothic P2", sans-serif' },
		].sort((a, b) => a.label.localeCompare(b.label));

		const fontSelector = document.getElementById("font-selector");
		const randomFontBtn = document.getElementById("random-font-btn");
		const preview = document.getElementById("preview");

		// populate <select> from fonts array
		fontSelector.innerHTML = "";	// clear existing
		fonts.forEach(font => {
			const option = document.createElement("option");
			option.value = font.value;
			option.textContent = font.label;
			if (font.label === "Yu Mincho (default)")
				option.selected = true;
			fontSelector.appendChild(option);
		});

		function applyPreviewFont() {
			preview.style.fontFamily = fontSelector.value || fonts[0].value;
		}

		fontSelector.addEventListener("change", applyPreviewFont);
		randomFontBtn.addEventListener("click", function() {
			const randomIndex = Math.floor(Math.random() * fonts.length);
			fontSelector.value = fonts[randomIndex].value;
			fontSelector.dispatchEvent(new Event("change")); // trigger update
		});

		// font size control
		const fontSizeInput = document.getElementById("font-size-input");
		const convertBtn = document.getElementById("convert-btn");

		function updateFontSize() {
			const size = parseInt(fontSizeInput.value);
			if (size >= 1 && size <= 60) {
				document.documentElement.style.setProperty(
					"--preview-font-size", `${size}px`);
				convertBtn.disabled = false;
				convertBtn.style.opacity = '1';
				convertBtn.style.cursor = 'pointer';
			} else {
				convertBtn.disabled = true;
				convertBtn.style.opacity = "0.5";
				convertBtn.style.cursor = "not-allowed";
			}
		}

		fontSizeInput.addEventListener("input", function(e) {
			// limit to only digits
			this.value = this.value.replace(/[^0-9]/g, "");
			const numValue = parseInt(this.value) || 0;
			if (this.value === "" || numValue === 0)
				this.value = "1";
			if (numValue > 60)
				this.value = "60";
			updateFontSize();
		});

		fontSizeInput.addEventListener("blur", function() {
			if (!this.value || parseInt(this.value) < 1)
				this.value = '25';
			updateFontSize();
		});

		updateFontSize();

		// too niche of a use case for this to have a function but i care just
		// because
		fontSelector.addEventListener("keydown", function(event) {
			const options = Array.from(this.options);
			const currentIndex = this.selectedIndex;
			const totalOptions = options.length;
			if (event.key === "ArrowDown") {
				event.preventDefault();
				this.selectedIndex = (currentIndex + 1) % totalOptions;
				this.dispatchEvent(new Event("change"));
			} else if (event.key === "ArrowUp") {
				event.preventDefault();
				this.selectedIndex = (currentIndex - 1 + totalOptions)
					% totalOptions;
				this.dispatchEvent(new Event("change"));
			}
		});
		applyPreviewFont();

		// automatically convert on link type change
		document.querySelectorAll('input[name="link-type"]').forEach(radio => {
			radio.addEventListener("change", function() {
				const convertBtn = document.getElementById("convert-btn");
				if (convertBtn)
					convertBtn.click();
			});
		});

		// returns a random string of cjk characters in this block by length
		function randomCJKString(block, length) {
			// use the shared ranges object (defined globally or passed in)
			const blockRanges = ranges[block];
			if (!blockRanges)
				return "";

			// function to pick a random code point from any range(s)
			function randFromRanges(rangesArray) {
				// pick a random range from the array of ranges
				const chosenRange = rangesArray[
					Math.floor(Math.random() * rangesArray.length)];
				const [start, end] = chosenRange;
				return start + Math.floor(Math.random() * (end - start + 1));
			}

			// build the string of given length
			let result = "";
			for (let i = 0; i < Math.max(0, length || 0); i++) {
				const codePoint = randFromRanges(blockRanges);
				result += String.fromCodePoint(codePoint);
			}
			return result;
		}

		document.getElementById("sample-text-btn").addEventListener("click", function() {
			length = 50;
			html =
			"CJK Unified Ideographs\n" + randomCJKString("cjk-unified", length) + "\n" +
			"CJK Extension A\n" + randomCJKString("cjk-a", length) + "\n" +
			"CJK Extension B\n" + randomCJKString("cjk-b", length) + "\n" +
			"CJK Extension C\n" + randomCJKString("cjk-c", length) + "\n" +
			"CJK Extension D\n" + randomCJKString("cjk-d", length) + "\n" +
			"CJK Extension E\n" + randomCJKString("cjk-e", length) + "\n" +
			"CJK Extension F\n" + randomCJKString("cjk-f", length) + "\n" +
			"CJK Extension G\n" + randomCJKString("cjk-g", length) + "\n" +
			"CJK Extension H\n" + randomCJKString("cjk-h", length) + "\n" +
			"CJK Extension I\n" + randomCJKString("cjk-i", length) + "\n" +
			"CJK Extension J\n" + randomCJKString("cjk-j", length) + "\n" +
			"CJK Compatibility Ideographs\n" + randomCJKString(
				"cjk-compat", length);
			document.getElementById("input-text").value = html;
			document.getElementById("convert-btn").click();
		});

		// clear button
		document.getElementById("clear-btn").addEventListener("click", function() {
			const inputText = document.getElementById("input-text");
			const preview = document.getElementById("preview");
			const charStats = document.getElementById("char-stats");

			inputText.value = "";
			preview.innerHTML = "„ÅÑ„Çç„ÅØ„Å´„Åª„Å∏„Å® „Å°„Çä„Å¨„Çã„Çí<br>„Çè„Åã„Çà„Åü„Çå„Åù„ÄÄ„Å§„Å≠„Å™„Çâ„ÇÄ<br>„ÅÜ„Çê„ÅÆ„Åä„Åè„ÇÑ„Åæ „Åë„Åµ„Åì„Åà„Å¶<br>„ÅÇ„Åï„Åç„ÇÜ„ÇÅ„Åø„Åó „Çë„Å≤„ÇÇ„Åõ„Åô";
			charStats.textContent = "";
			[	// reset all legend counters to 0
				"cjk-unified", "cjk-a", "cjk-b", "cjk-c", "cjk-d", "cjk-e",
				"cjk-f", "cjk-g", "cjk-h", "cjk-i", "cjk-j", "cjk-compat"
			].forEach(block => {
				const badge = document.querySelector(`[data-count="${block}"]`);
				if (badge) {
					badge.textContent = "0";
					badge.style.background = "rgba(52,152,219,0.2)";
					badge.style.color = "#2980b9";
				}
			});
			inputText.focus();
		});

		const layoutToggle = document.getElementById("layout-toggle");
		layoutToggle.addEventListener("click", function() {
			preview.classList.toggle("vertical");
			const isVertical = preview.classList.contains("vertical");
			// update button appearance and text
			if (isVertical) {
				this.classList.add("vertical");
				this.textContent = "‚Üï";
				this.title = "Toggle Vertical/Horizontal Layout";
			} else {
				this.classList.remove("vertical");
				this.textContent = "‚Üî";
				this.title = "Toggle Horizontal/Vertical Layout";
			}
		});

		const styleToggle = document.getElementById("style-toggle");

		let currentStyle = 0;	// 0=normal, 1=bold, 2=italic
		const styles = ["", "font-weight: bold", "font-style: italic"];

		styleToggle.addEventListener("click", function() {
			currentStyle = (currentStyle + 1) % 3;
			preview.setAttribute("style", styles[currentStyle]);
			const icons = ["ABC", 'ùë®ùë©ùë™', "ùíúùí∑ùí∏"]; 
			this.textContent = icons[currentStyle];
		});
	</script>
</body>
</html>